{% extends "base/base.html" %}

{% block titulo %}
    Inicio: {{ user.username }}
{% endblock %}

{% block contenido %}
    
<div class="card mx-auto text-center" style="max-width: 700px;">
    <div class="card-body">
        <h2 class="mb-5">{% if ramo %}Editar Ramo{% else %}Crear Ramo{% endif %}</h2>

        <form method="POST">
            {% csrf_token %}
            
            <div class="mb-3">
                <h5>Seleccionar Semestre</h5>
                <select name="semestre" class="form-control mb-5 w-50 d-block mx-auto" required>
                    <option value="">Selecciona un semestre</option>
                    {% for semestre in semestres %}
                        <option value="{{ semestre.id }}">{{ semestre.nombre }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-3">
                <h5>Nombre del ramo</h5>
                <input type="text" name="nombre" class="form-control mb-5 w-50 d-block mx-auto" required value="{{ ramo.nombre|default:'' }}">
            </div>

            <h5>Notas</h5>
            <div id="notas-container" class="text-center"></div>

            <button type="button" id="add-nota" class="btn btn-sm btn-info mb-5">+ Añadir nota</button>
            
            <h5>Examen</h5>
            <div id="examen-container" class="text-center"></div>

            <button type="button" id="toggle-examen" class="btn btn-sm btn-warning mb-5">Añadir examen</button>

            <button class="btn btn-info w-50 d-block mx-auto">{% if ramo %}Guardar cambios{% else %}Crear Ramo{% endif %}</button>
        </form>

    </div>
</div>

<script>
let notaCount = 0;
let examenAdded = false;

// Para añadir una fila de nota
function agregarNota(notaValue='0', porcValue='0') {
    notaCount++;
    let div = document.createElement("div");
    div.classList.add("mb-2", "d-flex", "gap-2", "justify-content-center");
    div.innerHTML = `
        <input type="number" step="0.1" name="nota_${notaCount}" placeholder="Nota" class="form-control" style="width:110px;" value="${notaValue}">
        <input type="number" step="0.1" name="porc_${notaCount}" placeholder="%" class="form-control" style="width:110px;" value="${porcValue}">
        <button type="button" class="btn btn-danger btn-sm remove-nota">-</button>
    `;
    document.getElementById("notas-container").appendChild(div);
    div.querySelector(".remove-nota").addEventListener("click", function(){
        div.remove();
    });
}

// Botón añadir nota
document.getElementById("add-nota").addEventListener("click", function(){
    agregarNota();
});

// Botón examen
document.getElementById("toggle-examen").addEventListener("click", function(){
    let container = document.getElementById("examen-container");
    if(!examenAdded){
        container.innerHTML = `
            <div class="mb-2 d-flex gap-2 justify-content-center">
                <input type="number" step="0.1" name="examen_nota" placeholder="Nota" class="form-control" style="width:110px;" value="0">
                <input type="number" step="0.1" name="examen_porcentaje" placeholder="%" class="form-control" style="width:110px;" value="0">
            </div>
        `;
        this.textContent = "Eliminar examen";
        examenAdded = true;
    } else {
        container.innerHTML = "";
        this.textContent = "Añadir examen";
        examenAdded = false;
    }
});

// Agregar una nota por defecto al cargar la página
document.addEventListener('DOMContentLoaded', function() {
    agregarNota();
});
</script>
{% endblock %}