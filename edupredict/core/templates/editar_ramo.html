{% extends "base.html" %}
{% block content %}

<div class="card mx-auto" style="max-width: 700px;">
    <div class="card-body">
        <h3 class="mb-3">Editar Ramo</h3>

        <form method="POST">
            {% csrf_token %}
            <div class="mb-3">
                <label>Nombre del ramo</label>
                <input type="text" name="nombre" class="form-control" value="{{ ramo.nombre }}" required>
            </div>

            <h5>Notas</h5>
            <div id="notas-container"></div>
            <button type="button" id="add-nota" class="btn btn-sm btn-primary mb-3">+ Añadir nota</button>
            
            <h5>Examen</h5>
            <div id="examen-container"></div>
            <button type="button" id="toggle-examen" class="btn btn-sm btn-info mb-3">
                {% if ramo.examen %}Eliminar examen{% else %}Añadir examen{% endif %}
            </button>

            <button class="btn btn-success w-100">Guardar Cambios</button>
        </form>

        <a href="/mi-semestre" class="btn btn-link w-100 mt-3">Volver a Mi Semestre</a>
    </div>
</div>

<script> // COMO HACER MARIHUANA CON MAIZENA Y JAVASCRIPT

let notasData = {{ ramo.notas|default:"[]"|safe }}; // Datos y Contador de notas y examenes
let examenData = {{ ramo.examen|default:"{}"|safe }};
let notaCount = 0;
let examenAdded = Object.keys(examenData).length > 0; // Si hay mas de 1 examen osea 1 (algo asi salia en stackoverflow)

// Funcion para añadir nota
function addNota(nota_val="", porc_val="") { 
    notaCount++;
    let div = document.createElement("div");
    div.classList.add("mb-2", "d-flex", "gap-2");
    div.innerHTML = `
        <input type="number" step="0.1" name="nota_${notaCount}" placeholder="Nota" class="form-control" style="width:70px;" value="${nota_val}">
        <input type="number" step="0.1" name="porc_${notaCount}" placeholder="%" class="form-control" style="width:70px;" value="${porc_val}">
        <button type="button" class="btn btn-danger btn-sm remove-nota">-</button>
    `;
    document.getElementById("notas-container").appendChild(div);

    div.querySelector(".remove-nota").addEventListener("click", function(){
        div.remove();
    });
}

// cargar notas existentes
notasData.forEach(n => {
    let nota_val = n.nota !== null ? n.nota : "";
    let porc_val = n.porcentaje !== null ? n.porcentaje : "";
    addNota(nota_val, porc_val);
});

// añadir nota boton
document.getElementById("add-nota").addEventListener("click", function(){
    addNota();
});

// lo de añadir o quitar examen va a qui mierda
let examenContainer = document.getElementById("examen-container");
let toggleBtn = document.getElementById("toggle-examen");
if(examenAdded){ // innterHTML, osea muñeca matrioshka de html a js a html para el boton
    examenContainer.innerHTML = `
        <div class="mb-2 d-flex gap-2">
            <input type="number" step="0.1" name="examen_nota" placeholder="Nota" class="form-control" style="width:70px;" value="${examenData.nota || ''}">
            <input type="number" step="0.1" name="examen_porcentaje" placeholder="%" class="form-control" style="width:70px;" value="${examenData.porcentaje || ''}">
        </div>
    `;
}

toggleBtn.addEventListener("click", function(){ // Usar .innnerHTML para meter los botones, html a js a html denuevo
    if(!examenAdded){
        examenContainer.innerHTML = `
            <div class="mb-2 d-flex gap-2">
                <input type="number" step="0.1" name="examen_nota" placeholder="Nota" class="form-control" style="width:70px;">
                <input type="number" step="0.1" name="examen_porcentaje" placeholder="%" class="form-control" style="width:70px;">
            </div>
        `;
        this.textContent = "Eliminar examen";
        examenAdded = true;
    } else {
        examenContainer.innerHTML = "";
        this.textContent = "Añadir examen";
        examenAdded = false;
    }
});
</script>

{% endblock %}
